{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}

<div class="auth-container">

    <!-- LEFT PANEL -->
    <div class="auth-left">
        <h1>CRSD</h1>
        <p>Plateforme institutionnelle d’aide à la décision</p>
    </div>

    <!-- RIGHT PANEL -->
    <div class="auth-right">
        <div class="auth-box">

            <!-- LOGO -->
            <div class="auth-logo">
                <img src="{{ url_for('static', filename='img/mshp_logo.png') }}"
                     alt="MSHP Logo">
                <h5>Bureau de Stratégie de Développement – BSD</h5>
            </div>

            <h2>Créer un compte</h2>

            <form method="POST">

                <div class="form-group">
                    <input type="text" name="first_name" placeholder="Nom" required>
                </div>

                <div class="form-group">
                    <input type="text" name="last_name" placeholder="Prénom" required>
                </div>

                <div class="form-group">
                    <input type="email" name="email" placeholder="Email" required>
                </div>

                <div class="form-group">
                    <input type="tel" name="phone" placeholder="Téléphone" required>
                </div>

                <!-- TYPE ACTEUR (DYNAMIQUE) -->
                <div class="form-group">
                    <select name="actor_type_id"
                            id="actor_type_id"
                            required
                            onchange="updateOrganisation()">
                        <option value="">Sélectionner un type d’acteur</option>
                        {% for actor in actor_types %}
                            <option value="{{ actor.id }}">
                                {{ actor.label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- ORGANISATION (DYNAMIQUE) -->
                <div class="form-group">
                    <select name="organisation_id"
                            id="organisation_id"
                            required>
                        <option value="">Sélectionner une organisation</option>
                    </select>
                </div>

                <div class="form-group">
                    <input type="password" name="password" placeholder="Mot de passe" required>
                </div>

                <div class="form-group">
                    <input type="password" name="confirm_password" placeholder="Confirmer le mot de passe" required>
                </div>

                <button type="submit" class="btn-login">
                    Créer un compte
                </button>
            </form>

            <div class="auth-footer">
                Vous avez déjà un compte ?
                <a href="{{ url_for('auth.login') }}">Se connecter</a>
            </div>
        </div>
    </div>
</div>

<!-- JS DYNAMIQUE POUR LES ORGANISATIONS -->
<script>
function updateOrganisation() {
    const actorTypeId = document.getElementById("actor_type_id").value;
    const organisationSelect = document.getElementById("organisation_id");

    organisationSelect.innerHTML =
        '<option value="">Sélectionner une organisation</option>';

    if (!actorTypeId) {
        return;
    }

    fetch(`/auth/organisations/${actorTypeId}`)
        .then(response => response.json())
        .then(data => {
            data.forEach(org => {
                const option = document.createElement("option");
                option.value = org.id;
                option.textContent = org.name;
                organisationSelect.appendChild(option);
            });
        });
}
</script>

{% endblock %}
